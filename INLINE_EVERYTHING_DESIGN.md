# ğŸ¯ All-Inline Maya Design
## ×›×œ ×”××¢×¨×›×ª ×‘×ª×•×š ×—×œ×•×Ÿ Maya - ××¤×¡ ××¡×›×™× ××œ××™×

---

## ğŸ”„ ×”××¨×›×™×˜×§×˜×•×¨×” ×”×—×“×©×” / New Architecture

### ×”×¨×¢×™×•×Ÿ:
**×—×œ×•×Ÿ ××—×“ ×©×œ Maya (400px x 520px) ×©××©× ×” ×ª×•×›×Ÿ ×œ×¤×™ state**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Maia AI        [ğŸ”„] [Toggle] [â–«][Ã—]â”‚ â† ××•×ª×• header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  STATE 1: Face Scanning             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ğŸ¥ ×”×ª××§× ××•×œ ×”××¦×œ××”        â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚ â”‚
â”‚  â”‚   â”‚  ğŸ“· Webcam  â”‚             â”‚ â”‚
â”‚  â”‚   â”‚   Preview   â”‚             â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â”‚   Capturing 1/2...            â”‚ â”‚
â”‚  â”‚   [××•: ×–×™×”×•×™ ×¤× ×™× ×‘-PIN]     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  STATE 2: PIN Entry                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ğŸ” ×”×–×Ÿ PIN                  â”‚ â”‚
â”‚  â”‚   [â—] [â—] [â—‹] [â—‹]             â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”                  â”‚ â”‚
â”‚  â”‚   â”‚1 â”‚2 â”‚3 â”‚                  â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¤                  â”‚ â”‚
â”‚  â”‚   â”‚4 â”‚5 â”‚6 â”‚                  â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”´â”€â”€â”´â”€â”€â”˜                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  STATE 3: Clock-In                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ×©×œ×•× Danny! ğŸ‘‹              â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”             â”‚ â”‚
â”‚  â”‚   â”‚ ğŸ‘¨â€ğŸ’» â”‚ â”‚ ğŸ‘¨â€ğŸ³â”‚             â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  STATE 4: Chat (Final)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ’¬ Messages...               â”‚ â”‚
â”‚  â”‚  ğŸ“ Input...                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ ×”×§×•××¤×•× × ×˜×•×ª / Components

### 1. MayaOverlay - The Only Component
**×ª×¤×§×™×“:** ×—×œ×•×Ÿ ×™×—×™×“ ×©×× ×”×œ ××ª ×›×œ ×”-states

**Props:**
```typescript
interface MayaOverlayProps {
  // No special props needed - manages its own auth state
}
```

**Internal State:**
```typescript
const [authState, setAuthState] = useState<AuthState>('INITIAL');
const [employee, setEmployee] = useState<Employee | null>(null);
const [messages, setMessages] = useState<Message[]>([]);

type AuthState =
  | 'INITIAL'           // Just opened, not authenticated
  | 'FACE_SCANNING'     // Scanning face
  | 'PIN_ENTRY'         // Entering PIN
  | 'IDENTIFIED'        // Employee identified, checking requirements
  | 'CLOCK_IN_REQUIRED' // Need to select role
  | 'AUTHORIZED'        // Ready for chat
  | 'ERROR';            // Error state
```

**Render Logic:**
```typescript
return (
  <AnimatePresence>
    {!isOpen && <MayaButton onClick={() => setIsOpen(true)} />}

    {isOpen && (
      <motion.div className="fixed ... 400px x 520px">
        <Header />

        <div className="flex-1">
          {authState === 'INITIAL' && <StartScreen />}
          {authState === 'FACE_SCANNING' && <FaceScannerCompact />}
          {authState === 'PIN_ENTRY' && <PINPadCompact />}
          {authState === 'IDENTIFIED' && <IdentifiedScreen />}
          {authState === 'CLOCK_IN_REQUIRED' && <ClockInModalInline />}
          {authState === 'AUTHORIZED' && <ChatInterface />}
          {authState === 'ERROR' && <ErrorScreen />}
        </div>
      </motion.div>
    )}
  </AnimatePresence>
);
```

---

## ğŸ“¦ ×§×•××¤×•× × ×˜×•×ª ××©× ×” / Sub-Components

### A. FaceScannerCompact
**×’×•×“×œ:** ××ª××™× ×œ-400px width

```typescript
<div className="p-4 space-y-4">
  <h3 className="text-center text-white text-sm">×”×ª××§× ××•×œ ×”××¦×œ××”</h3>

  {/* Compact Webcam - 200x200px */}
  <div className="relative w-48 h-48 mx-auto">
    <Webcam className="rounded-2xl" />
    <div className="absolute inset-0 border-2 border-cyan-400 rounded-2xl" />
  </div>

  <p className="text-center text-xs text-white/60">
    ×¦×™×œ×•× {captureCount}/2...
  </p>

  <button onClick={switchToPIN} className="text-xs">
    ××• ×”×©×ª××© ×‘-PIN
  </button>
</div>
```

### B. PINPadCompact
**×’×•×“×œ:** 3x3 grid ×§×˜×Ÿ (×‘××§×•× 3x4)

```typescript
<div className="p-4 space-y-4">
  <h3 className="text-center text-white text-sm">×”×–×Ÿ PIN</h3>

  {/* PIN Display */}
  <div className="flex justify-center gap-2">
    {[0,1,2,3].map(i => <PinDot filled={pin.length > i} />)}
  </div>

  {/* Compact 3x4 Grid - smaller buttons */}
  <div className="grid grid-cols-3 gap-2">
    {[1,2,3,4,5,6,7,8,9,'â†',0,'âœ“'].map(key => (
      <button className="h-12 text-sm rounded-xl ...">
        {key}
      </button>
    ))}
  </div>

  <button onClick={switchToFace} className="text-xs">
    ×—×–×•×¨ ×œ×–×™×”×•×™ ×¤× ×™×
  </button>
</div>
```

### C. ClockInModalInline
**×›×‘×¨ × ×•×¦×¨! âœ…** - ××•×©×œ× ×œ×’×•×“×œ ×”×–×”

### D. ChatInterface
**×›×‘×¨ ×§×™×™×! âœ…** - messages + input

---

## ğŸ”„ State Flow

```
User clicks Maya (âœ¨)
  â†“
MayaOverlay opens â†’ authState = 'INITIAL'
  â†“
Show StartScreen: "×”×ª×—×œ ×¢× ×–×™×”×•×™ ×¤× ×™× ××• PIN"
  â†“
User clicks "×–×™×”×•×™ ×¤× ×™×" â†’ authState = 'FACE_SCANNING'
  â†“
FaceScannerCompact captures face
  â†“
Call /verify-face â†’ authState = 'IDENTIFIED'
  â†“
Check if needs clock-in
  â†“ (if worker)
authState = 'CLOCK_IN_REQUIRED'
  â†“
ClockInModalInline shown
  â†“
User selects role â†’ Call /clock-in
  â†“
authState = 'AUTHORIZED'
  â†“
ChatInterface shown
```

---

## ğŸ¨ UI Specifications

### Window Size:
- **Width:** 400px (fixed)
- **Height:** 520px (fixed)
- **Position:** bottom-left with drag support
- **Border:** `border-2 border-cyan-400/30`
- **Background:** `bg-slate-900/90 backdrop-blur-xl`

### Header (56px):
```typescript
<div className="h-14 bg-gradient-to-r from-purple-600/50 to-pink-600/50">
  <GripVertical /> {/* Drag handle */}
  <Logo />
  <Title />
  <RefreshButton />
  <MinimizeButton />
  <CloseButton />
</div>
```

### Body (464px):
```typescript
<div className="h-[464px] flex flex-col">
  {/* Dynamic content based on authState */}
  <AnimatePresence mode="wait">
    {renderCurrentState()}
  </AnimatePresence>
</div>
```

---

## ğŸ“ Component Sizes

| Component | Width | Height | Notes |
|-----------|-------|--------|-------|
| MayaOverlay | 400px | 520px | Fixed |
| Header | 400px | 56px | Fixed |
| Body | 400px | 464px | Flexible content |
| FaceScannerCompact | 360px | ~300px | Webcam 200x200 |
| PINPadCompact | 360px | ~350px | 3x4 grid |
| ClockInModalInline | 360px | ~300px | 2x2 grid |
| ChatInterface | 360px | 464px | Full body |

---

## ğŸš€ Implementation Plan

### Step 1: Create Compact Components
```
âœ… ClockInModalInline (already done)
ğŸ†• FaceScannerCompact (new - 200x200 webcam)
ğŸ†• PINPadCompact (new - smaller grid)
ğŸ†• StartScreen (new - choose face or PIN)
```

### Step 2: Refactor MayaOverlay
```typescript
// Add auth state management
const [authState, setAuthState] = useState('INITIAL');
const [employee, setEmployee] = useState(null);

// Add verification handlers
const handleFaceVerify = async (embedding) => {
  // Call /verify-face
  // Set employee
  // Check clock-in requirements
};

const handlePINVerify = async (pin) => {
  // Call /verify-pin
  // Set employee
  // Check clock-in requirements
};

const handleClockIn = async (role) => {
  // Call /clock-in
  // Set authorized
};
```

### Step 3: Conditional Rendering
```typescript
<div className="h-[464px]">
  <AnimatePresence mode="wait">
    {authState === 'INITIAL' && <StartScreen />}
    {authState === 'FACE_SCANNING' && (
      <FaceScannerCompact onSuccess={handleFaceVerify} />
    )}
    {authState === 'PIN_ENTRY' && (
      <PINPadCompact onSuccess={handlePINVerify} />
    )}
    {authState === 'CLOCK_IN_REQUIRED' && (
      <ClockInModalInline onSuccess={handleClockIn} />
    )}
    {authState === 'AUTHORIZED' && (
      <ChatInterface messages={messages} ... />
    )}
  </AnimatePresence>
</div>
```

### Step 4: Remove MayaGateway
```
âŒ Delete MayaGateway.tsx (no longer needed)
âŒ Delete MayaGatewayComplete.tsx (no longer needed)
âŒ Delete MayaAuthContext.tsx (state now in MayaOverlay)
```

---

## âœ¨ Benefits

1. âœ… **Single Window** - ×”×›×œ ×‘××§×•× ××—×“
2. âœ… **Consistent Size** - ×ª××™×“ 400x520px
3. âœ… **Smooth Transitions** - AnimatePresence ×‘×™×Ÿ states
4. âœ… **Simple Architecture** - ×§×•××¤×•× × ×˜×” ××—×ª ×‘××§×•× 3
5. âœ… **Easy to Test** - state machine ×¤×©×•×˜ ×™×•×ª×¨
6. âœ… **Better UX** - ×œ× ×§×•×¤×¥ ××—×œ×•×Ÿ ×œ×—×œ×•×Ÿ

---

## ğŸ“ File Structure (New)

```
components/maya/
â”œâ”€â”€ MayaOverlay.tsx              ğŸ”§ REFACTORED (all-in-one)
â”œâ”€â”€ FaceScannerCompact.tsx       ğŸ†• NEW
â”œâ”€â”€ PINPadCompact.tsx            ğŸ†• NEW (reuse PINPad logic)
â”œâ”€â”€ ClockInModalInline.tsx       âœ… EXISTS
â””â”€â”€ StartScreen.tsx              ğŸ†• NEW

DELETED:
âŒ MayaGateway.tsx
âŒ MayaGatewayComplete.tsx
âŒ MayaAuthContext.tsx
âŒ FaceScanner.tsx (full size)
âŒ ClockInModal.tsx (full size)
```

---

## ğŸ¯ Next Steps

1. **Create FaceScannerCompact** - compact webcam for 400px window
2. **Create PINPadCompact** - reuse PINPad logic, smaller UI
3. **Create StartScreen** - choose face or PIN
4. **Refactor MayaOverlay** - add state machine + all handlers
5. **Test inline flow** - everything in one window

---

**×¨×•×¦×” ×©××ª×—×™×œ ×œ×™×¦×•×¨ ××ª ×”×§×•××¤×•× × ×˜×•×ª ×”×§×•××¤×§×˜×™×•×ª?** ğŸš€
